{% extends 'base.html' %}

{% block content %}
<h1>{{ article.title }}</h1>
<p>–ê–≤—Ç–æ—Ä: {{ article.author.username }}</p>
<p>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: {{ article.created_at }}</p>
{% if article.image %}
<img src="{{ article.image.url }}" alt="{{ article.title }}" style="max-width: 100%; height: auto;">
{% endif %}
<p>{{ article.content }}</p>


{% if user.is_authenticated %}
<form action="{% url 'save_article' article.id %}" method="POST">
    {% csrf_token %}
    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
</form>
{% else %}
<p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç—å–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.</p>
{% endif %}

<h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h2>
{% for comment in article.comments.all %}
<div>
    <p>{{ comment.author_id.user.username }}: {{ comment.text }} <small>({{ comment.date_published }})</small></p>
    <button class="like-btn" data-comment-id="{{ comment.id }}">üëç {{ comment.likes }}</button>
    <button class="dislike-btn" data-comment-id="{{ comment.id }}">üëé {{ comment.dislikes }}</button>
</div>
{% endfor %}

<h3>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }} 
    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
</form>

<script>
    document.querySelectorAll('.like-btn').forEach(button => {
        button.addEventListener('click', function () {
            const commentId = this.dataset.commentId;
            fetch(`/comment/like/${commentId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
            })
                .then(response => response.json())
                .then(data => {
                    this.textContent = `üëç ${data.likes}`;
                });
        });
    });

    document.querySelectorAll('.dislike-btn').forEach(button => {
        button.addEventListener('click', function () {
            const commentId = this.dataset.commentId;
            fetch(`/comment/dislike/${commentId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
            })
                .then(response => response.json())
                .then(data => {
                    this.textContent = `üëé ${data.dislikes}`;
                });
        });
    });
</script>
{% endblock %}